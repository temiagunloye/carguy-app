<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop Simulator | Garage Manager</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/visualizer.css">
</head>

<body>

    <div class="visualizer-container">

        <!-- Left Panel: Controls -->
        <div class="hud-panel hud-left">
            <div class="hud-panel-header">
                <span>Configuration</span>
                <a href="/" class="text-xs text-muted" style="text-decoration:none; color: #a1a1aa;">&larr; Exit</a>
            </div>

            <div class="hud-panel-content">
                <!-- Vehicle -->
                <div class="control-group">
                    <label class="control-label">Vehicle</label>
                    <select id="vehicle-selector" class="vehicle-select">
                        <option value="" disabled selected>Select Base Car...</option>
                        <!-- Populated by JS -->
                    </select>
                </div>

                <!-- Wrap -->
                <div class="control-group">
                    <label class="control-label">Wrap / Paint</label>
                    <div id="wrap-selector" class="color-grid">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Parts -->
                <div class="control-group">
                    <label class="control-label">Installed Parts</label>
                    <div id="parts-list">
                        <!-- Populated by JS -->
                        <div class="part-toggle-item">
                            <span>Front Lip</span>
                            <input type="checkbox" data-part="lip" onchange="updateVisualizer()">
                        </div>
                        <div class="part-toggle-item">
                            <span>Side Skirts</span>
                            <input type="checkbox" data-part="skirts" onchange="updateVisualizer()">
                        </div>
                        <div class="part-toggle-item">
                            <span>Rear Wing</span>
                            <input type="checkbox" data-part="wing" onchange="updateVisualizer()">
                        </div>
                        <div class="part-toggle-item">
                            <span>Lowering Springs</span>
                            <input type="checkbox" data-part="lowered" onchange="updateVisualizer()">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Center Panel: Viewer -->
        <div class="hud-center">
            <div class="viewer-canvas">
                <img id="main-vehicle-image" src="/assets/images/placeholder-car.png" alt="Vehicle Preview"
                    class="vehicle-image">

                <!-- Loading State -->
                <div id="loading-spinner" style="position:absolute; display:none;">
                    <svg class="animate-spin" width="32" height="32" viewBox="0 0 24 24" fill="none" class="text-white">
                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" stroke-dasharray="30 60">
                        </circle>
                    </svg>
                </div>
            </div>

            <!-- Angle Nav -->
            <div class="angle-nav">
                <div class="angle-dot active" onclick="setAngle(0)"></div>
                <div class="angle-dot" onclick="setAngle(1)"></div>
                <div class="angle-dot" onclick="setAngle(2)"></div>
                <div class="angle-dot" onclick="setAngle(3)"></div>
                <div class="angle-dot" onclick="setAngle(4)"></div>
                <div class="angle-dot" onclick="setAngle(5)"></div>
                <div class="angle-dot" onclick="setAngle(6)"></div>
                <div class="angle-dot" onclick="setAngle(7)"></div>
                <div class="angle-dot" onclick="setAngle(8)"></div>
                <div class="angle-dot" onclick="setAngle(9)"></div>
            </div>
        </div>

        <!-- Right Panel: Summary -->
        <div class="hud-panel hud-right">
            <div class="hud-panel-header">
                <span>Build Summary</span>
                <span id="save-status" class="text-xs text-green-500" style="opacity:0;">Saved</span>
            </div>

            <div class="hud-panel-content">
                <div class="build-summary-card">
                    <h3 id="summary-vehicle-name" style="margin-bottom:var(--space-md);">Select a vehicle</h3>

                    <div class="summary-row">
                        <span class="text-muted">Wrap</span>
                        <span id="summary-wrap">None</span>
                    </div>

                    <div class="summary-row">
                        <span class="text-muted">Parts</span>
                        <span id="summary-parts-count">0 installed</span>
                    </div>

                    <div class="summary-total">
                        <div class="summary-row" style="margin-bottom:0;">
                            <span>Est. Total</span>
                            <span id="summary-cost">$0</span>
                        </div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn-viz btn-viz-primary" onclick="generateShareLink()">
                        Share Build
                    </button>
                    <button class="btn-viz btn-viz-secondary" onclick="saveLocalBuild()">
                        Save to Device
                    </button>
                    <button class="btn-viz btn-viz-secondary" onclick="clearBuild()"
                        style="border-color: #ef4444; color: #ef4444;">
                        Clear
                    </button>
                </div>

                <div style="margin-top: var(--space-xl);">
                    <label class="control-label">Local Builds</label>
                    <div id="local-builds-list" style="font-size: 0.8rem; color: var(--text-muted);">
                        <!-- Populated by JS -->
                        <p>No saved builds</p>
                    </div>
                </div>
            </div>

            <div class="hud-panel-footer">
                <div style="display:flex; gap: 10px; align-items:center;">
                    <img src="/assets/icons/favicon.png" width="24" height="24" alt="GM">
                    <span style="font-weight:600; font-size:12px;">GARAGE MANAGER</span>
                </div>
            </div>
        </div>

    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, doc, getDoc, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getStorage, ref, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

        // Firebase Config (Replace with your actual config from firebase.json or console)
        // I will use a placeholder or read from a file if I could, but for client-side I need the config object.
        // Assuming standard config structure. Since I don't have the keys here, I'll attempt to fetch them or assume valid initialization if environment setup is correct.
        // For V1 benchmark, I'll assume the /__/firebase/init.js auto-config if hosted on Firebase Hosting, 
        // OR explicitly paste the config if known. Since I am in a dev environment, I'll fetch valid config from a known file or use a placeholder that needs replacement.
        // I'll grab the config from `src/lib/firebase.ts` if it has it, or `firebase-config.js` if it exists.

        // TEMPORARY: Using placeholder config. User needs to verify connection string.
        const firebaseConfig = {
            // TODO: Populate with real config
            apiKey: "AIzaSy...",
            authDomain: "carguy-app-v1.firebaseapp.com",
            projectId: "carguy-app-v1",
            storageBucket: "carguy-app-v1.appspot.com",
            messagingSenderId: "...",
            appId: "..."
        };

        // Initialize logic for Visualizer
        // ... (I will move this to a separate js/visualizer.js file)
    </script>
    <script type="module" src="/js/visualizer.js"></script>
</body>

</html>